<div class="app-container">
  <header class="header" *ngIf="isAuthenticated">
    <div class="header-content">
      <div class="logo-section">
        <img src="/logo-r-loc.jpg" alt="R-Loc Logo" class="logo">
      </div>

      <!-- Menu hamb√∫rguer (apenas mobile) -->
      <button class="menu-toggle" (click)="toggleMobileMenu()" [class.active]="isMobileMenuOpen">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <!-- Navega√ß√£o principal -->
      <nav class="nav" [class.mobile-open]="isMobileMenuOpen">
        <div class="nav-content">
          <a routerLink="/dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}"
            (click)="closeMobileMenu()">
            Dashboard
          </a>
          <a routerLink="/clientes" routerLinkActive="active" (click)="closeMobileMenu()">
            Clientes
          </a>
          <a routerLink="/equipamentos" routerLinkActive="active" (click)="closeMobileMenu()">
            Equipamentos
          </a>
          <a routerLink="/orcamentos" routerLinkActive="active" (click)="closeMobileMenu()">
            Or√ßamentos
          </a>
          <a routerLink="/locacoes" routerLinkActive="active" (click)="closeMobileMenu()">
            Loca√ß√µes
          </a>
          <a *ngIf="isMasterUser()" routerLink="/funcionarios" routerLinkActive="active" (click)="closeMobileMenu()">
            Funcion√°rios
          </a>
          <!-- <a *ngIf="isMasterUser()" routerLink="/logs" routerLinkActive="active" (click)="closeMobileMenu()">
            Logs
          </a> -->
          <a *ngIf="isMasterUser()" routerLink="/relatorios" routerLinkActive="active" (click)="closeMobileMenu()">
            Relat√≥rios
          </a>
          <a *ngIf="isMasterUser()" (click)="openConfigModal(); closeMobileMenu()" style="cursor: pointer;">
            Config
          </a>

          <div class="user-section">
            <span class="user-info">üë§ {{ currentUser }}</span>
            <button class="btn btn-secondary btn-sm logout-btn" (click)="logout()">
              Sair
            </button>
          </div>
        </div>
      </nav>

      <!-- Overlay separado para mobile -->
      <div class="nav-overlay" (click)="closeMobileMenu()" *ngIf="isMobileMenuOpen"></div>
    </div>
  </header>

  <main class="main-content" [class.no-header]="!isAuthenticated">
    <router-outlet></router-outlet>
  </main>

  <!-- Modal de Configura√ß√£o -->
  <div class="modal" [class.show]="showConfigModal" [style.display]="showConfigModal ? 'flex' : 'none'">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">‚öôÔ∏è Configura√ß√µes do Sistema</h5>
          <button type="button" class="close" (click)="closeConfigModal()">
            <span>&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div *ngIf="isLoadingConfig" class="text-center" style="padding: 30px;">
            <p>Carregando configura√ß√µes...</p>
          </div>
          <form *ngIf="!isLoadingConfig">

            <!-- Se√ß√£o WhatsApp -->
            <div style="margin-bottom: 20px;">
              <h6
                style="font-weight: bold; color: #25d366; margin-bottom: 12px; display: flex; align-items: center; gap: 6px;">
                üì± WhatsApp (UazAPI)
              </h6>
              <div style="background: #f8f9fa; border-radius: 8px; padding: 12px; border: 1px solid #e9ecef;">

                <!-- Status indicator -->
                <div style="margin-bottom: 12px; font-size: 12px; color: #6c757d;">
                  <span *ngIf="uazapiConfig.url && uazapiConfig.token">
                    ‚úÖ Credenciais configuradas
                  </span>
                  <span *ngIf="!uazapiConfig.url || !uazapiConfig.token" style="color: #dc3545;">
                    ‚ö†Ô∏è Credenciais n√£o configuradas
                  </span>
                </div>

                <div class="form-group">
                  <label for="uazapiUrl" style="font-size: 13px; font-weight: 600;">URL do Servidor</label>
                  <input type="text" class="form-control" id="uazapiUrl" [(ngModel)]="uazapiConfig.url" name="url"
                    placeholder="https://free.uazapi.com">
                  <small class="form-text text-muted">Endere√ßo base da API UazAPI</small>
                </div>

                <div class="form-group">
                  <label for="uazapiToken" style="font-size: 13px; font-weight: 600;">Token da Inst√¢ncia</label>
                  <div style="position: relative;">
                    <input [type]="showToken ? 'text' : 'password'" class="form-control" id="uazapiToken"
                      [(ngModel)]="uazapiConfig.token" name="token" placeholder="Token UUID da inst√¢ncia WhatsApp"
                      style="padding-right: 80px;">
                    <button type="button" (click)="showToken = !showToken" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%);
                             background: none; border: none; cursor: pointer; color: #6c757d; font-size: 12px;">
                      {{ showToken ? 'üôà Ocultar' : 'üëÅÔ∏è Ver' }}
                    </button>
                  </div>
                  <small class="form-text text-muted">Token UUID da inst√¢ncia (n√£o o Admin Token)</small>
                </div>
              </div>
            </div>

            <!-- Se√ß√£o Fuso Hor√°rio -->
            <div>
              <h6
                style="font-weight: bold; color: #0d6efd; margin-bottom: 12px; display: flex; align-items: center; gap: 6px;">
                üïê Fuso Hor√°rio do Sistema
              </h6>
              <div style="background: #f8f9fa; border-radius: 8px; padding: 12px; border: 1px solid #e9ecef;">
                <div class="form-group" style="margin-bottom: 0;">
                  <select class="form-control" id="timezone" [(ngModel)]="timezone" name="timezone">
                    <option *ngFor="let tz of timezones" [value]="tz">{{ tz }}</option>
                  </select>
                  <small class="form-text text-muted">Afeta datas em PDFs, contratos e recibos</small>
                </div>
              </div>
            </div>

          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeConfigModal()">Cancelar</button>
          <button type="button" class="btn btn-primary" (click)="saveConfig()" [disabled]="isLoadingConfig">
            {{ isLoadingConfig ? 'Salvando...' : 'üíæ Salvar' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>