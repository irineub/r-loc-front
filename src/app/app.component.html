<div class="app-container">
  <header class="header" *ngIf="isAuthenticated">
    <div class="header-content">
      <div class="logo-section">
        <img src="/logo-r-loc.jpg" alt="R-Loc Logo" class="logo">
      </div>

      <!-- Menu hamb√∫rguer (apenas mobile) -->
      <button class="menu-toggle" (click)="toggleMobileMenu()" [class.active]="isMobileMenuOpen">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <!-- Navega√ß√£o principal -->
      <nav class="nav" [class.mobile-open]="isMobileMenuOpen">
        <div class="nav-content">
          <a routerLink="/dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}"
            (click)="closeMobileMenu()">
            Dashboard
          </a>
          <a routerLink="/clientes" routerLinkActive="active" (click)="closeMobileMenu()">
            Clientes
          </a>
          <a routerLink="/equipamentos" routerLinkActive="active" (click)="closeMobileMenu()">
            Equipamentos
          </a>
          <a routerLink="/orcamentos" routerLinkActive="active" (click)="closeMobileMenu()">
            Or√ßamentos
          </a>
          <a routerLink="/locacoes" routerLinkActive="active" (click)="closeMobileMenu()">
            Loca√ß√µes
          </a>
          <a *ngIf="isMasterUser()" routerLink="/funcionarios" routerLinkActive="active" (click)="closeMobileMenu()">
            Funcion√°rios
          </a>
          <!-- <a *ngIf="isMasterUser()" routerLink="/logs" routerLinkActive="active" (click)="closeMobileMenu()">
            Logs
          </a> -->
          <a *ngIf="isMasterUser()" routerLink="/relatorios" routerLinkActive="active" (click)="closeMobileMenu()">
            Relat√≥rios
          </a>
          <a *ngIf="isMasterUser()" (click)="openConfigModal(); closeMobileMenu()" style="cursor: pointer;">
            Config
          </a>

          <div class="user-section">
            <span class="user-info">üë§ {{ currentUser }}</span>
            <button class="btn btn-secondary btn-sm logout-btn" (click)="logout()">
              Sair
            </button>
          </div>
        </div>
      </nav>

      <!-- Overlay separado para mobile -->
      <div class="nav-overlay" (click)="closeMobileMenu()" *ngIf="isMobileMenuOpen"></div>
    </div>
  </header>

  <main class="main-content" [class.no-header]="!isAuthenticated">
    <router-outlet></router-outlet>
  </main>

  <!-- Modal de Configura√ß√£o -->
  <div class="modal" [class.show]="showConfigModal" [style.display]="showConfigModal ? 'flex' : 'none'">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">‚öôÔ∏è Configura√ß√µes do Sistema</h5>
          <button type="button" class="close" (click)="closeConfigModal()">
            <span>&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div *ngIf="isLoadingConfig" class="text-center" style="padding: 30px;">
            <p>Carregando configura√ß√µes...</p>
          </div>
          <form *ngIf="!isLoadingConfig">

            <!-- Header and Tab Nav -->
            <div class="config-tabs"
              style="display: flex; gap: 8px; margin-bottom: 24px; border-bottom: 2px solid #f1f5f9; padding-bottom: 8px;">
              <button type="button" (click)="activeConfigTab = 'whatsapp'"
                [class.active]="activeConfigTab === 'whatsapp'" class="tab-btn"
                style="flex: 1; padding: 10px; border: none; background: transparent; font-weight: 600; color: #64748b; cursor: pointer; border-radius: 8px; transition: all 0.2s;">
                WhatsApp
              </button>
              <button type="button" (click)="activeConfigTab = 'timezone'"
                [class.active]="activeConfigTab === 'timezone'" class="tab-btn"
                style="flex: 1; padding: 10px; border: none; background: transparent; font-weight: 600; color: #64748b; cursor: pointer; border-radius: 8px; transition: all 0.2s;">
                Fuso Hor√°rio
              </button>
              <button type="button" (click)="activeConfigTab = 'upload'" [class.active]="activeConfigTab === 'upload'"
                class="tab-btn"
                style="flex: 1; padding: 10px; border: none; background: transparent; font-weight: 600; color: #64748b; cursor: pointer; border-radius: 8px; transition: all 0.2s;">
                Uploads
              </button>
            </div>

            <!-- Se√ß√£o WhatsApp -->
            <div *ngIf="activeConfigTab === 'whatsapp'" class="tab-pane" style="animation: fadeIn 0.3s ease;">
              <div style="background: #f8fafc; border-radius: 12px; padding: 20px; border: 1px solid #e2e8f0;">
                <p style="font-size: 13px; color: #64748b; margin-bottom: 16px;">Configura√ß√µes de integra√ß√£o com a
                  UazAPI para envio de mensagens autom√°ticas.</p>

                <!-- Status indicator -->
                <div style="margin-bottom: 20px; font-size: 13px; font-weight: 500; padding: 10px; border-radius: 8px;"
                  [ngStyle]="{'background': (uazapiConfig.url && uazapiConfig.token) ? '#dcfce7' : '#fee2e2', 'color': (uazapiConfig.url && uazapiConfig.token) ? '#166534' : '#991b1b'}">
                  <span *ngIf="uazapiConfig.url && uazapiConfig.token">Credenciais Ativas</span>
                  <span *ngIf="!uazapiConfig.url || !uazapiConfig.token">Credenciais Ausentes</span>
                </div>

                <div class="form-group" style="margin-bottom: 16px;">
                  <label for="uazapiUrl"
                    style="display: block; font-size: 14px; font-weight: 600; color: #334155; margin-bottom: 6px;">URL
                    do Servidor</label>
                  <input type="text" class="form-control" id="uazapiUrl" [(ngModel)]="uazapiConfig.url" name="url"
                    placeholder="https://free.uazapi.com">
                </div>

                <div class="form-group" style="margin-bottom: 0;">
                  <label for="uazapiToken"
                    style="display: block; font-size: 14px; font-weight: 600; color: #334155; margin-bottom: 6px;">Token
                    da Inst√¢ncia</label>
                  <div style="position: relative;">
                    <input [type]="showToken ? 'text' : 'password'" class="form-control" id="uazapiToken"
                      [(ngModel)]="uazapiConfig.token" name="token" placeholder="UUID da inst√¢ncia"
                      style="padding-right: 80px;">
                    <button type="button" (click)="showToken = !showToken"
                      style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
                             background: #e2e8f0; border: none; border-radius: 6px; padding: 4px 8px; cursor: pointer; color: #475569; font-size: 12px; font-weight: 600;">
                      {{ showToken ? 'Ocultar' : 'Mostrar' }}
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Se√ß√£o Fuso Hor√°rio -->
            <div *ngIf="activeConfigTab === 'timezone'" class="tab-pane" style="animation: fadeIn 0.3s ease;">
              <div style="background: #f8fafc; border-radius: 12px; padding: 20px; border: 1px solid #e2e8f0;">
                <p style="font-size: 13px; color: #64748b; margin-bottom: 16px;">As datas relativas e sauda√ß√µes aos
                  clientes se baseiam no hor√°rio configurado abaixo.</p>

                <div class="form-group" style="margin-bottom: 0;">
                  <label for="timezone"
                    style="display: block; font-size: 14px; font-weight: 600; color: #334155; margin-bottom: 6px;">Fuso
                    Hor√°rio Padr√£o</label>
                  <select class="form-control" id="timezone" [(ngModel)]="timezone" name="timezone"
                    style="background-color: white;">
                    <option *ngFor="let tz of timezones" [value]="tz">{{ tz }}</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Se√ß√£o de Arquivos (Upload) -->
            <div *ngIf="activeConfigTab === 'upload'" class="tab-pane" style="animation: fadeIn 0.3s ease;">
              <div style="background: #f8fafc; border-radius: 12px; padding: 20px; border: 1px solid #e2e8f0;">
                <p style="font-size: 13px; color: #64748b; margin-bottom: 20px;">M√©todo e configura√ß√£o para envio de PDF
                  (contratos/recibos).</p>

                <div class="form-group"
                  style="padding: 12px; background: white; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 16px;">
                  <div style="display: flex; align-items: flex-start;">
                    <input type="checkbox" id="useBase64" [(ngModel)]="uploadConfig.use_base64" name="useBase64"
                      style="margin-top: 4px; margin-right: 12px; transform: scale(1.2);">
                    <div>
                      <label for="useBase64"
                        style="font-size: 14px; font-weight: 600; color: #334155; margin-bottom: 4px; cursor: pointer;">Empacotamento
                        Direto (Base64) - Recomendado</label>
                      <small class="form-text text-muted" style="display: block; line-height: 1.4; color: #64748b;">
                        Dispensa URLs p√∫blicas. O arquivo n√£o possuir√° t√≠tulo no WhatsApp ("Sem T√≠tulo.pdf"), por√©m o
                        sistema contornar√° isso enviando uma mensagem pr√©via de identifica√ß√£o.
                      </small>
                    </div>
                  </div>
                </div>

                <div class="form-group" *ngIf="!uploadConfig.use_base64" style="animation: fadeIn 0.3s ease;">
                  <label for="publicUrl"
                    style="display: block; font-size: 14px; font-weight: 600; color: #334155; margin-bottom: 6px;">URL
                    Base P√∫blica do Backend (Avan√ßado)</label>
                  <input type="text" class="form-control" id="publicUrl" [(ngModel)]="uploadConfig.public_url"
                    name="publicUrl" placeholder="https://api.meudominio.com" style="background: white;">
                  <small style="display: block; margin-top: 6px; color: #64748b; font-size: 12px; line-height: 1.4;">
                    Requer dom√≠nio pr√≥prio ou t√∫neis confi√°veis (como Nginx Proxy ou Locahost.run). Arquivos ter√£o o
                    t√≠tulo real exibido no WhatsApp.
                  </small>
                </div>
              </div>
            </div>

          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeConfigModal()">Cancelar</button>
          <button type="button" class="btn btn-primary" (click)="saveConfig()" [disabled]="isLoadingConfig">
            {{ isLoadingConfig ? 'Salvando...' : 'üíæ Salvar' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>